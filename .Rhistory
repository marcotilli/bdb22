ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track2(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play2(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
ex_track <- df_track %>%
filter(gameId==gId, playId==pId) %>%
select(-c('gameId', 'playId'))
View(ex_track)
ex_track$playDirection[1] == 'right'
120-ex_track$x
ex_track <- df_track %>%
filter(gameId==gId, playId==pId) %>%
select(-c('gameId', 'playId')) %>%
# flip play, s.t. punt/kick always goes from left to RIGHT
# x:   ? 120-x ist nicht richtig glaube ich? (v.a. siehe max(df_track$x))
# dir: dir mod 180 ? -> flips horizontally AND vertically --> also flip y
mutate(x = ifelse(
ex_track$playDirection[1] == 'right',
x, 120-x),
y = ifelse(
ex_track$playDirection[1] == 'right',
y, 160/3-y),
dir = ifelse(
ex_track$playDirection[1] == 'right',
dir, dir%%180))
ex_track = convert_radiant(ex_track, ex_game)
source('./helpers.R')
source('./bdb_animate_plot_field.R')
source('./calc_fieldcontrol.R')
source('./calc_spacevalue.R')
ex_gameId <- 2018101406
ex_playId <- 2021
gId <- 2018101406
pId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track2(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play2(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
source('./helpers.R')
ex_gameId <- 2018101406
ex_playId <- 2021
gId <- 2018101406
pId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track2(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play2(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
source('./helpers.R')
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track2(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play2(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
View(ex_track_)
View(ex_track)
View(ex_track %Y% filter(event %in% event_))
View(ex_track %>% filter(event %in% event_))
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
source('./helpers.R')
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
source('./helpers.R')
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
source('./helpers.R')
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
View(ex_play)
df_games <- read_games(year)
df_plays <- read_plays(year)
df_players <- read_players()
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
source('./helpers.R')
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
View(ex_track %>% filter(event %in% event_))
source('./helpers.R')
# Punt Medium Gain:     2018101402 1357
# Punt Fair catch:      2018101406 2021
# Punt TD:              2018120208 3040
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
View(ex_track %>% filter(event %in% event_))
ex_track <- df_track %>%
filter(gameId==gId, playId==pId) %>%
mutate(x_ = x, y_ = y, dir_ = dir) %>%
select(-c('gameId', 'playId')) %>%
# flip play, s.t. punt/kick always goes from left to RIGHT
# x:   ? 120-x ist nicht richtig glaube ich? (v.a. siehe max(df_track$x))
# dir: dir mod 180 ? -> flips horizontally AND vertically --> also flip y
mutate(x = ifelse(playDirection[1] == 'right', x_, 120 - x_),
y = ifelse(playDirection[1] == 'right', y_, 160/3 - y_),
dir = ifelse(playDirection[1] == 'right', dir_, (dir+180)%%360)) #%>%
source('./helpers.R')
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
View(ex_track %>% filter(event %in% event_))
source('./helpers.R')
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
View(ex_track %>% filter(event %in% event_))
source('./helpers.R')
# Punt TD:              2018120208 3040
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
View(ex_track %>% filter(event %in% event_))
dftrack <- dftrack %>%
mutate(
dir_rad = dir * pi / 180,
v_x = sin(dir_rad) * s,
v_y = cos(dir_rad) * s,
v_theta = atan(v_y / v_x),
v_theta = ifelse(is.nan(v_theta), 0, v_theta),
team_name = case_when(
team == "home" ~ ex_game$homeTeamAbbr,
team == "away" ~ ex_game$visitorTeamAbbr,
TRUE ~ team,
)) %>%
select(frameId, event, team = team_name, jerseyNumber, displayName,
x, y, s, v_theta, v_x, v_y, playDirection)
source('./helpers.R')
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
event_ = ball_snap
event_ = 'ball_snap'
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
ex_play <- df_plays %>%
filter(gameId==gId, playId==pId) %>%
mutate(line_of_scrimmage = ifelse(
playdir == 'right',
absoluteYardlineNumber,
120 - absoluteYardlineNumber)) %>%
select(-c(absoluteYardlineNumber))
source('./helpers.R')
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
event_ = 'ball_snap'
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
ex_playId <- 3040
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
event_ = 'ball_snap'
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
View(ex_game)
# take one example play and extract data
# Kickoff Medium Gain:  2018090905 3524
# Kickoff TD:           2018102102 1452
# Punt Medium Gain:     2018101402 1357
# Punt Fair catch:      2018101406 2021
# Punt TD:              2018120208 3040
ex_gameId <- 2018120208
ex_playId <- 3040
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
View(ex_track)
method = 'frame'
event_ = 'ball_snap'
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
# take one example play and extract data
# Kickoff Medium Gain:  2018090905 3524
# Kickoff TD:           2018102102 1452
# Punt Medium Gain:     2018101402 1357
# Punt Fair catch:      2018101406 2021
# Punt TD:              2018120208 3040
ex_gameId <- 2018101406
ex_playId <- 2021
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
# take one example play and extract data
# Kickoff Medium Gain:  2018090905 3524
# Kickoff TD:           2018102102 1452
# Punt Medium Gain:     2018101402 1357
# Punt Fair catch:      2018101406 2021
# Punt TD:              2018120208 3040
ex_gameId <- 2018120208
ex_playId <- 3040
ex_game  <- adapt_single_game(df_games, ex_gameId)
ex_track <- adapt_single_track_flip(df_track, ex_game, ex_gameId, ex_playId)
ex_play  <- adapt_single_play_flip(df_plays, ex_track$playDirection[1], ex_gameId, ex_playId)
ex_track <- ex_track %>% select(-c('playDirection'))
#rm(df_track, df_plays, df_games)
method = 'frame'
#method = 'field_control_spacevalue'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
method = 'field_control_basic'
event_ = c(paste('punt', 'received', sep='_'),
paste('kick', 'received', sep='_'),
'fair_catch')
if (method == 'animate'){
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, '', method = method)
} else if (method == 'frame' || method == 'field_control_basic'){
ex_track_ <- func_calc_fc_combined(ex_track)
if (method == 'frame'){
ex_track_ <- ex_track_ %>% filter(event %in% event_)
}
df_control  <- ex_track_ %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control, ex_game$homeTeamAbbr)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track_, df_control, method)
} else if (method == 'field_control_spacevalue'){
retName  <- df_players %>% filter(nflId == strtoi(ex_play$returnerId))
ex_track <- func_calc_fc_combined(ex_track)
df_control  <- ex_track %>%
filter(team != "football") %>%
group_split(frameId) %>%
map_dfr(., compute_team_frame_control2, ex_game$homeTeamAbbr, retName$displayName)
play_anim <- bdb_animate_plot_field(ex_game, ex_play, ex_track, df_control, method)
}
play_anim
View(ex_play)
